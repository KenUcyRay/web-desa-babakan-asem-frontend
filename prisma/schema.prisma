generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enum

enum ResidentType {
  GENDER
  PERNIKAHAN
  AGAMA
  USIA
  KEPALA_KELUARGA
  PERKERJAAN
  PENDIDIKAN
  WAJIB_PILIH
  DUSUN
  ANAK_ANAK
}

enum Role {
  REGULAR // Regular user with basic access
  ADMIN
  PKK
  KARANG_TARUNA
  BPD
  CONTRIBUTOR
}

enum MapType {
  POLYGON
  MARKER
}

enum ActivityLogLocation {
  NEWS
  AGENDA
  GALLERY
  MESSAGE
  BUMDES
  VILLAGEWORKPROGRAM
  USER
}

enum VillageWorkProgramStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TargetType {
  NEWS
  AGENDA
  PRODUCT
}

enum AgendaType {
  REGULAR
  PKK
  KARANG_TARUNA
  DPD
  BPD
}

enum StatusDesa {
  MAJU
  BERKEMBANG
  MANDIRI
  TERTINGGAL
  SANGAT_TERTINGGAL
}

enum PengantarType {
  KTP
  KK
  SKCK
  LAINNYA
}

enum Organization {
  PEMERINTAH
  PKK
  KARANG_TARUNA
  DPD
  BPD
}

//Rill Fix

model SiteContent {
  id         String          @id @default(uuid())
  key        String          @unique @db.VarChar(255)
  value_id   String          @db.Text
  value_en   String          @db.Text
  type       SiteContentType
  created_at DateTime        @default(now())
  updated_at DateTime        @updatedAt

  @@map("site_contents")
}

enum SiteContentType {
  TEXT
  LINK
  IMAGE
  VIDEO
}

model Map {
  id          String   @id @default(uuid())
  type        MapType
  name        String
  description String
  year        Int
  coordinates Json
  icon        String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("maps")
}

model ActivityLog {
  id         String              @id @default(uuid())
  user_id    String
  action     String              @db.VarChar(255)
  location   ActivityLogLocation
  created_at DateTime            @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("activity_logs")
}

model User {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(255)
  phone_number String?  @db.VarChar(20)
  email        String?  @db.VarChar(255)
  password     String   @db.VarChar(255)
  role         Role
  reset_token  String?  @db.VarChar(500)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  comments    Comment[]
  ActivityLog ActivityLog[]

  @@map("users")
}

model Message {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(255)
  email        String?  @db.VarChar(255)
  phone_number String?  @db.VarChar(20)
  message      String   @db.Text()
  is_read      Boolean  @default(false)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@map("messages")
}

//fix i think

model Pengantar {
  id         String        @id @default(uuid())
  name       String
  nik        String
  type       PengantarType
  keterangan String
  is_pending Boolean       @default(true)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@map("pengantar")
}

model Galeri {
  id         String   @id @default(uuid())
  image      String   @db.VarChar(255)
  title      String   @db.VarChar(255)
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("galeri")
}

model News {
  id             String    @id @default(uuid())
  userId         String
  title          String    @db.VarChar(255)
  content        String    @db.Text
  featured_image String    @db.VarChar(255)
  view_count     Int       @default(0)
  is_published   Boolean   @default(false)
  published_at   DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  @@map("news")
}

model Program {
  id             String   @id @default(uuid())
  title          String   @db.VarChar(255)
  description    String   @db.Text
  featured_image String   @db.VarChar(255)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("programs")
}

model Member {
  id                String       @id @default(uuid())
  name              String       @db.VarChar(255)
  position          String       @db.VarChar(255)
  profile_photo     String       @db.VarChar(255)
  term_start        Int
  term_end          Int
  is_term           Boolean      @default(false)
  important_level   Int          @default(1)
  organization_type Organization

  @@map("members")
}

model Idm {
  id         String   @id @default(uuid())
  year       Int
  skor       Float
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("idms")
}

model ExtraIdm {
  id          String     @id @default(uuid())
  status_desa StatusDesa
  sosial      Float
  ekonomi     Float
  lingkungan  Float
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  @@map("extra_idms")
}

model SocialAssistance {
  id         String   @id @default(uuid())
  name       String
  amount     Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("social_assistances")
}

model Sdgs {
  id         String   @id @default(uuid())
  name       String
  progress   Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("sdgs")
}

model Agenda {
  id             String     @id @default(uuid())
  userId         String
  title          String     @db.VarChar(255)
  content        String     @db.Text
  featured_image String     @db.VarChar(255)
  location       String     @db.VarChar(255)
  start_time     DateTime
  end_time       DateTime
  view_count     Int        @default(0)
  is_published   Boolean    @default(false)
  published_at   DateTime?
  type           AgendaType @default(REGULAR)
  created_at     DateTime   @default(now())
  updated_at     DateTime   @updatedAt

  @@map("agenda")
}

model Product {
  id             String   @id @default(uuid())
  user_id        String
  category_id    String
  title          String   @db.VarChar(255)
  description    String   @db.Text
  price          Float
  featured_image String   @db.VarChar(255)
  link_whatsapp  String   @db.VarChar(255)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  category Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  ratings  Rating[]

  @@map("products")
}

model Category {
  id         String   @id @default(uuid())
  name       String   @db.VarChar(255)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  products Product[]

  @@map("categories")
}

model Rating {
  id         String   @id @default(uuid())
  user_id    String
  product_id String
  rating     Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@map("ratings")
}

model Comment {
  id          String     @id @default(uuid())
  user_id     String
  target_id   String
  target_type TargetType
  content     String     @db.Text()
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("comments")
}

// yang atas migrasi dari microservice

model VillageWorkProgram {
  id            String                   @id @default(uuid())
  description   String                   @db.Text
  date          DateTime                 @db.Date
  status        VillageWorkProgramStatus
  justification String                   @db.Text
  budget_amount Decimal                  @db.Decimal(15, 2)
  created_at    DateTime                 @default(now())
  updated_at    DateTime                 @updatedAt

  @@map("village_work_programs")
}

model VillageAchievement {
  id             String   @id @default(uuid())
  title          String   @db.VarChar(255)
  description    String   @db.Text
  date           DateTime @db.Date
  featured_image String   @db.VarChar(255)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("village_achievements")
}

model Resident {
  id            String       @id @default(uuid())
  key           String       @unique @db.VarChar(255)
  value         Int          @db.Int
  resident_type ResidentType
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt

  @@map("resident_statistics")
}

model Apb {
  id        String   @id @default(uuid())
  bidang    String
  anggaran  Decimal  @db.Decimal(15, 2)
  realisasi Decimal  @db.Decimal(15, 2)
  tahun     DateTime @db.Date
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("apb")
}
